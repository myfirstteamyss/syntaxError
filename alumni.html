<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Alumni Dashboard</title>

<!-- Chart.js + PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

<style>
/* Base */
* { box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #1e3c40 0%, #1a374d 100%);
  margin: 0; color: #ffffff;
}
header {
  background-color: rgba(26,49,55,0.92);
  color: #ffffff;
  padding: 15px 30px; 
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
header h1 { 
  margin:0; font-size:1.8rem; letter-spacing:1.2px; font-weight:700; color: #ffffff;
}
header p { 
  margin:4px 0 0; font-size:1rem; font-weight:400; color:#a0f0e0; 
}

.intro {
  max-width:1100px; margin:20px auto; padding:18px 24px;
  background: rgba(209,242,235,0.06); border-radius:12px;
  box-shadow: 0 6px 14px rgba(30,60,64,0.4); color:#ffffff;
  font-size:1.05rem; line-height:1.6;
}

.container { max-width:1100px; margin:18px auto 40px; padding:0 12px; }

/* Dashboard grid */
.charts-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-auto-rows: 320px;
  gap: 0; border-radius: 8px; overflow: hidden;
}
.chart-tile {
  background: #0f2b2b; padding: 12px; border: 1px solid rgba(255,255,255,0.05);
}
.chart-title {
  color: #ffffff; font-weight:700; margin: 0 0 8px 0; font-size:1rem;
}
.chart-canvas { width:100% !important; height: 280px !important; }

/* Directory / Controls */
.section {
  background: rgba(255,255,255,0.05);
  border-radius: 12px; padding: 18px; margin-top: 18px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.15); color: #ffffff;
}

.controls {
  display:flex; gap:10px; align-items:center; margin-bottom:12px; flex-wrap:wrap;
}
.controls input, .controls select {
  padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1);
  background:#164949; color:#ffffff; font-weight:500;
}

table {
  width:100%; border-collapse: collapse; margin-top:8px;
}
th, td {
  padding:10px; text-align:left; font-size:0.95rem; color:#ffffff;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}
th { background: rgba(20,90,85,0.95); font-weight:700; color:#ffffff; position: sticky; top:0; }
tbody tr:hover td { background: rgba(26,188,156,0.2); }

a.profile-link { color:#1abc9c; text-decoration:none; font-weight:600; }
a.profile-link:hover { text-decoration:underline; }

footer {
  max-width:1100px; margin:26px auto 40px; padding:14px 18px;
  background: rgba(26,49,55,0.85); border-radius: 12px; color:#ffffff; text-align:center;
}

/* Responsive */
@media (max-width:900px) {
  .charts-grid { grid-template-columns: 1fr; grid-auto-rows: 360px; }
}
</style>
</head>
<body>

<header>
  <h1>Alumni Dashboard</h1>
  <p>Network insights • Innovations • Career stats — powered by your alumni dataset</p>
</header>

<div class="intro">
  <strong>Overview:</strong> This dashboard visualizes alumni data — passout years, employers, locations, job roles, profiles, and innovation ideas. Use the directory below to search and inspect individual alumni. Charts are interactive (hover / legend click) and update automatically from the CSV file.
</div>

<div class="container">

  <!-- Charts Grid -->
  <div class="charts-grid" role="region" aria-label="Alumni charts">
    <div class="chart-tile">
      <div class="chart-title">Alumni by Pass-out Year (Pie)</div>
      <canvas id="chartYear" class="chart-canvas" aria-label="Alumni by pass-out year"></canvas>
    </div>

    <div class="chart-tile">
      <div class="chart-title">Top Companies (Bar)</div>
      <canvas id="chartCompany" class="chart-canvas" aria-label="Alumni by company"></canvas>
    </div>

    <div class="chart-tile">
      <div class="chart-title">Locations (Column)</div>
      <canvas id="chartLocation" class="chart-canvas" aria-label="Alumni by location"></canvas>
    </div>

    <div class="chart-tile">
      <div class="chart-title">Career Progression by Year (Line)</div>
      <canvas id="chartCareer" class="chart-canvas" aria-label="Alumni career progression"></canvas>
    </div>

    <div class="chart-tile">
      <div class="chart-title">Profiles (GitHub vs LinkedIn) (Donut)</div>
      <canvas id="chartProfiles" class="chart-canvas" aria-label="Alumni profiles"></canvas>
    </div>

    <div class="chart-tile">
      <div class="chart-title">Innovations Trend (Area)</div>
      <canvas id="chartInnov" class="chart-canvas" aria-label="Alumni innovations over years"></canvas>
    </div>
  </div>

  <!-- Directory / Filters -->
  <section class="section" aria-labelledby="directoryTitle">
    <h2 id="directoryTitle" style="color:#1abc9c; margin-top:0;">Alumni Directory</h2>

    <div class="controls" aria-hidden="false">
      <input id="searchBox" placeholder="Search by name, company, job, location..." aria-label="Search alumni" />
      <select id="filterYear" aria-label="Filter by passout year">
        <option value="">All Years</option>
      </select>
      <select id="filterCompany" aria-label="Filter by company">
        <option value="">All Companies</option>
      </select>
      <button id="resetFilters" style="background:#1abc9c; color:#042826; padding:8px 12px; border-radius:8px; border:none;">Reset</button>
    </div>

    <div style="overflow:auto; max-height:420px;">
      <table aria-describedby="directoryTitle">
        <thead>
          <tr>
            <th>Name</th><th>Passout Year</th><th>Job Title</th><th>Company</th><th>Location</th><th>GitHub / LinkedIn</th>
          </tr>
        </thead>
        <tbody id="directoryBody"></tbody>
      </table>
    </div>
  </section>

</div>

<footer>
  Questions? Contact <a href="mailto:alumni-office@university.edu" style="color:#1abc9c;">alumni-office@university.edu</a> • © 2025 University Alumni Portal
</footer>

<script>
function groupCounts(arr, key){const map={};arr.forEach(r=>{const v=(r[key]||'').toString().trim();if(!v)return;map[v]=(map[v]||0)+1;});return map;}
function sortEntriesByValue(obj,desc=true){return Object.entries(obj).sort((a,b)=>desc?b[1]-a[1]:a[1]-b[1]);}

Papa.parse("alumni_dashboard_unique_names.csv",{download:true,header:true,skipEmptyLines:true,complete:function(results){
  const raw=results.data.map(r=>({Alumni_ID:r.Alumni_ID||'',Name:(r.Name||'').trim(),Passout_Year:(r.Passout_Year||'').toString().trim(),Innovation_Thoughts:(r.Innovation_Thoughts||'').trim(),Company:(r.Company||'').trim(),Job_Title:(r.Job_Title||'').trim(),Location:(r.Location||'').trim(),GitHub_Profile:(r.GitHub_Profile||'').trim(),LinkedIn_Profile:(r.LinkedIn_Profile||'').trim()})).filter(x=>x.Name);
  buildDashboard(raw);
},error:function(err){console.error("CSV load error:",err);alert("Failed to load CSV. Make sure 'alumni_dashboard_unique_names.csv' is in the same folder as this HTML file.");}});

function buildDashboard(data){
  const yearCounts=groupCounts(data,"Passout_Year");
  const companyCounts=groupCounts(data,"Company");
  const locationCounts=groupCounts(data,"Location");
  const careerEntries=Object.keys(yearCounts).sort();
  const careerCounts=careerEntries.map(y=>yearCounts[y]||0);

  let githubCount=0,linkedinCount=0,bothCount=0;
  data.forEach(r=>{const g=!!r.GitHub_Profile,l=!!r.LinkedIn_Profile;if(g&&l)bothCount++;else if(g)githubCount++;else if(l)linkedinCount++;});

  const innovByYear={};
  data.forEach(r=>{const y=r.Passout_Year||"Unknown";if(!innovByYear[y])innovByYear[y]=new Set();if(r.Innovation_Thoughts)innovByYear[y].add(r.Innovation_Thoughts);});
  const innovYears=Object.keys(innovByYear).sort();
  const innovCounts=innovYears.map(y=>innovByYear[y].size);

  const palette=['#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f','#edc948','#af7aa1','#ff9da7','#9c755f'];

  const chartOptions={
    responsive:true,
    maintainAspectRatio:false,
    plugins:{legend:{labels:{color:'#ffffff'}},tooltip:{titleColor:'#ffffff',bodyColor:'#ffffff'}},
    scales:{x:{ticks:{color:'#ffffff'}},y:{beginAtZero:true,ticks:{color:'#ffffff'}}}
  };

  new Chart(document.getElementById('chartYear').getContext('2d'),{type:'pie',data:{labels:Object.keys(yearCounts),datasets:[{data:Object.values(yearCounts),backgroundColor:palette}]},options:chartOptions});
  
  const sortedCompanies=sortEntriesByValue(companyCounts).slice(0,10);
  new Chart(document.getElementById('chartCompany').getContext('2d'),{type:'bar',data:{labels:sortedCompanies.map(e=>e[0]),datasets:[{label:'Alumni',data:sortedCompanies.map(e=>e[1]),backgroundColor:palette}]},options:chartOptions});

  const sortedLoc=sortEntriesByValue(locationCounts).slice(0,10);
  new Chart(document.getElementById('chartLocation').getContext('2d'),{type:'bar',data:{labels:sortedLoc.map(e=>e[0]),datasets:[{label:'Alumni',data:sortedLoc.map(e=>e[1]),backgroundColor:palette}]},options:chartOptions});

  new Chart(document.getElementById('chartCareer').getContext('2d'),{type:'line',data:{labels:careerEntries,datasets:[{label:'Alumni count',data:careerCounts,borderColor:'#59a14f',backgroundColor:'rgba(89,161,79,0.12)',fill:true,tension:0.2} ]},options:chartOptions});

  new Chart(document.getElementById('chartProfiles').getContext('2d'),{type:'doughnut',data:{labels:['GitHub only','LinkedIn only','Both'],datasets:[{data:[githubCount,linkedinCount,bothCount],backgroundColor:['#f28e2b','#4e79a7','#59a14f']}]},options:chartOptions});

  new Chart(document.getElementById('chartInnov').getContext('2d'),{type:'line',data:{labels:innovYears,datasets:[{label:'Distinct Innovation Ideas',data:innovCounts,borderColor:'#e15759',backgroundColor:'rgba(225,87,89,0.12)',fill:true,tension:0.2}]},options:chartOptions});

  const tbody=document.getElementById('directoryBody'),searchBox=document.getElementById('searchBox'),filterYear=document.getElementById('filterYear'),filterCompany=document.getElementById('filterCompany'),resetBtn=document.getElementById('resetFilters');
  Object.keys(yearCounts).sort().forEach(y=>{const o=document.createElement('option');o.value=y;o.textContent=y;filterYear.appendChild(o);});
  sortEntriesByValue(companyCounts).map(e=>e[0]).forEach(c=>{const o=document.createElement('option');o.value=c;o.textContent=c;filterCompany.appendChild(o);});

  function renderRows(rows){
    tbody.innerHTML='';
    if(!rows.length){const tr=document.createElement('tr');tr.innerHTML='<td colspan="6" style="color:#ffdede">No matching records.</td>';tbody.appendChild(tr);return;}
    rows.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${escapeHtml(r.Name)}</td><td>${escapeHtml(r.Passout_Year)}</td><td>${escapeHtml(r.Job_Title)}</td><td>${escapeHtml(r.Company)}</td><td>${escapeHtml(r.Location)}</td><td>${r.GitHub_Profile?`<a class="profile-link" href="${escapeAttr(r.GitHub_Profile)}" target="_blank" rel="noopener">GitHub</a>`:''}${r.GitHub_Profile&&r.LinkedIn_Profile?' / ':''}${r.LinkedIn_Profile?`<a class="profile-link" href="${escapeAttr(r.LinkedIn_Profile)}" target="_blank" rel="noopener">LinkedIn</a>`:''}</td>`;tbody.appendChild(tr);});
  }

  function escapeHtml(s){if(!s)return'';return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}
  function escapeAttr(s){return escapeHtml(s);}
  renderRows(data);

  function applyFilters(){
    const q=(searchBox.value||'').toLowerCase().trim(),fy=filterYear.value,fc=filterCompany.value;
    const filtered=data.filter(r=>{if(fy&&r.Passout_Year!==fy)return false;if(fc&&r.Company!==fc)return false;if(!q)return true;return(`${r.Name} ${r.Company} ${r.Job_Title} ${r.Location}`.toLowerCase()).includes(q);});
    renderRows(filtered);
  }
  searchBox.addEventListener('input',applyFilters);
  filterYear.addEventListener('change',applyFilters);
  filterCompany.addEventListener('change',applyFilters);
  resetBtn.addEventListener('click',()=>{searchBox.value='';filterYear.value='';filterCompany.value='';applyFilters();});
}
</script>

</body>
</html>
